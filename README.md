# Assistants Frontend

## 1. Авторизация и доступ к аккаунту

### Функционал
- **SSO Авторизация через Gmail**
  - При загрузке главной страницы отображается кнопка для входа через Google SSO
  - Реализовано на бэкенде
- **Проверка подписки**
  - После авторизации отображается статус подписки пользователя
  - Статус загружается с бэкенда

### Компоненты
- `LoginPage` – страница авторизации с кнопкой "Войти через Google"
- `AccountStatus` – отображение текущего состояния подписки

## 2. Основной экран: Таблица взаимодействий

### Структура таблицы
- Email пользователя
- Name – имя пользователя
- Description – краткое описание ассистента
- Статус – кнопка переключения (Stop/Active)
- Удаление – кнопка удаления пользователя

### Компоненты
- `InteractionTable` – основная таблица взаимодействий
- `ToggleStatusButton` – управление статусом
- `DeleteButton` – удаление взаимодействия

### API-взаимодействие
- Получение списка пользователей
- Управление статусом взаимодействия
- Удаление пользователя с сохранением истории

## 3. История переписки

### Функционал
- Просмотр хронологии сообщений
- Возврат к основной таблице

### Компоненты
- `ChatHistoryModal` – модальное окно истории
- `CloseButton` – кнопка возврата к таблице

### API-взаимодействие
- Загрузка истории переписки при открытии модального окна

## 4. Навигация

### Маршруты
- `/login` – страница авторизации
- `/dashboard` – основная страница с таблицей
- `/dashboard/chat-history/:id` – история переписки

## Структура проекта

```
src/
├── components/
│   ├── LoginPage.tsx
│   ├── AccountStatus.tsx
│   ├── InteractionTable.tsx
│   ├── ToggleStatusButton.tsx
│   ├── DeleteButton.tsx
│   ├── ChatHistoryModal.tsx
│   └── CloseButton.tsx
├── routes/
│   ├── login.tsx
│   ├── dashboard.tsx
│   └── chat-history.tsx
└── api/
    ├── auth.ts
    ├── interactions.ts
    └── chatHistory.ts
```

# Технологический стек проекта

## Основные технологии

### Remix.run
- Современный фреймворк для React-приложений
- Преимущества:
  - Улучшенное SEO
  - Быстрая загрузка страниц
  - Удобная серверная обработка данных

### React
- Основная библиотека для UI-компонентов
- Базовая платформа для Remix.run

### TypeScript
- Типизированный JavaScript
- Преимущества:
  - Повышенная надёжность кода
  - Улучшенная поддерживаемость
  - Удобная разработка

### Стилизация
- **Tailwind CSS**
  - Утилитарный CSS-фреймворк
  - Гибкая система классов
  - Поддержка адаптивного дизайна
- **CSS Modules** (альтернатива)
  - Изоляция стилей компонентов
  - Предотвращение конфликтов имён

## API-взаимодействие

### HTTP-клиенты
- **Axios**
  - Популярная библиотека для HTTP-запросов
- **Remix Fetch API** (встроенный)
  - Нативное решение от Remix

### Основные API-операции
- Авторизация пользователей
- Получение данных пользователей
- Управление статусами
- Работа с историей переписки

## API Endpoints

### Авторизация
```
GET /api/auth/check
```
- Проверка статуса авторизации
- Получение информации о подписке


# Backend API Endpoints

## Аутентификация (/auth)

### GET /auth/google/login
**Назначение:** Генерация URL для авторизации через Google OAuth

**Принимает:** -  
**Возвращает:**
```json
{
    "authorization_url": "string" // URL для редиректа на страницу авторизации Google
}
```
**Примечание:** Устанавливает cookie `oauth_state` для безопасности

### GET /auth/google/callback 
**Назначение:** Обработка callback от Google после успешной авторизации

**Принимает:**
- `code`: string - код авторизации от Google
- `state`: string - токен безопасности

**Возвращает:**
```json
{
    "status": "success",
    "message": "Successfully authenticated",
    "is_new_user": boolean
}
```
**Примечание:** Устанавливает cookie `access_token` с JWT токеном

### POST /auth/set-password
**Назначение:** Добавление пароля к аккаунту OAuth

**Принимает:**
- `password`: string

**Требует:** JWT аутентификацию

**Возвращает:**
```json
{
    "status": "success", 
    "message": "Password successfully set"
}
```

### GET /auth/check
**Назначение:** Проверка валидности текущей сессии и Google токенов

**Требует:** JWT аутентификацию

**Возвращает:**
```json
{
    "authenticated": true,
    "user": {
        "id": number,
        "email": string,
        "name": string
    },
    "google_oauth": {
        "connected": boolean,
        "token_status": "valid" | "refreshed" | "invalid" | null
    }
}
```

## Ассистенты (/assistants)

### POST /assistants/email/gmail
**Назначение:** Проверка валидности Gmail токена

**Принимает:**
- `token`: string (Gmail access token в заголовке Authorization)

**Возвращает:**
```json
{
    "status": "success",
    "message": "Gmail токен валиден"
}
```
**Ошибки:** 
- 401 - невалидный токен
- 500 - внутренняя ошибка сервера

## Интеграции
Все эндпоинты интегрированы с:
- Google OAuth для аутентификации
- JWT для управления сессиями  
- Автоматическим обновлением токенов
- Базой данных для хранения учетных данных пользователей

нужно запускать с remix dev