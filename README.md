# Email AI Frontend

Данное приложение представляет фронтенд для работы с Email AI – платформой, которая позволяет пользователю автономно общаться с выбранными почтовыми ящиками от своего имени. В основе платформы лежит LLM (Large Language Model), которому через интуитивно понятный интерфейс можно создавать и настраивать уникальную личность с помощью кастомных инструкций. Помимо этого, приложение включает авторизацию через Google, отображение информации о подписке, работу с таблицей взаимодействий и историю переписки.

---

## Содержание

1. [Авторизация и доступ к аккаунту](#авторизация-и-доступ-к-аккаунту)
2. [Основной экран: Таблица взаимодействий](#основной-экран-таблица-взаимодействий)
3. [История переписки](#история-переписки)
4. [Навигация и маршруты](#навигация-и-маршруты)
5. [Технологический стек](#технологический-стек)
6. [API-взаимодействие](#api-взаимодействие)
7. [Backend API Endpoints](#backend-api-endpoints)
8. [Запуск приложения](#запуск-приложения)

---

## Авторизация и доступ к аккаунту

### Функциональные возможности

- **SSO авторизация через Gmail**
  - На главной странице отображается кнопка для входа через Google.
  - Авторизация реализована с использованием бэкенда.
  
- **Проверка подписки**
  - После успешной авторизации пользователю отображается текущий статус подписки, который загружается с бэкенда.

---

## Основной экран: Таблица взаимодействий

### Структура таблицы

В таблице взаимодействий отображаются следующие поля:

- **Email пользователя**
- **Name** – имя пользователя.
- **Description** – краткое описание ассистента.
- **Статус** – кнопка для переключения между состояниями (Stop/Active).
- **Удаление** – кнопка для удаления пользователя.

### API-взаимодействие

- **Получение списка пользователей.**
- **Управление статусом взаимодействия.**
- **Удаление пользователя** (при этом история переписки сохраняется).

---

## История переписки

### Функционал

- Просмотр хронологии сообщений.
- Возврат к основной таблице взаимодействий.

### API-взаимодействие

- Загрузка истории переписки происходит при открытии соответствующего маршрута.

---

## Навигация и маршруты

Приложение включает маршруты для авторизации, просмотра таблицы взаимодействий и истории переписки, реализованные с использованием Remix.run роутинга.

---

## Технологический стек

### Основные технологии

- **Remix.run**
  - Современный фреймворк для React-приложений.
  - Преимущества:
    - Улучшенное SEO.
    - Быстрая загрузка страниц.
    - Удобная серверная обработка данных с использованием loaders и actions.

- **React**
  - Библиотека для создания UI-компонентов.
  - Базовая платформа для приложения, построенного на Remix.run.

- **TypeScript**
  - Типизированный вариант JavaScript.
  - Преимущества:
    - Повышенная надёжность кода.
    - Улучшенная поддерживаемость.
    - Удобство разработки.

### Стилизация

- **Tailwind CSS**
  - Утилитарный CSS-фреймворк.
  - Гибкая система классов и поддержка адаптивного дизайна.

---

## API-взаимодействие

### Основные операции API

- Авторизация пользователей.
- Получение данных о пользователях.
- Управление статусами взаимодействий.
- Работа с историей переписки.

### Пример запроса для проверки авторизации

```http
GET /api/auth/check
```

- **Назначение:** Проверка статуса авторизации и получение информации о подписке.

---

## Backend API Endpoints

### Аутентификация (/auth)

#### 1. **GET /auth/google/login**

- **Назначение:** Генерация URL для авторизации через Google OAuth.
- **Возвращает:**  
  ```json
  {
      "authorization_url": "string"
  }
  ```
  *(URL для редиректа на страницу авторизации Google)*  
- **Примечание:** Устанавливает cookie `oauth_state` для безопасности.

#### 2. **GET /auth/google/callback**

- **Назначение:** Обработка callback от Google после успешной авторизации.
- **Принимает:**  
  - `code`: string – код авторизации от Google.
  - `state`: string – токен безопасности.
- **Возвращает:**  
  ```json
  {
      "status": "success",
      "message": "Successfully authenticated",
      "is_new_user": boolean
  }
  ```
- **Примечание:** Устанавливает cookie `access_token` с JWT токеном.

#### 3. **POST /auth/set-password**

- **Назначение:** Добавление пароля к аккаунту, зарегистрированному через OAuth.
- **Принимает:**  
  - `password`: string
- **Требует:** JWT аутентификацию.
- **Возвращает:**  
  ```json
  {
      "status": "success", 
      "message": "Password successfully set"
  }
  ```

#### 4. **GET /auth/check**

- **Назначение:** Проверка валидности текущей сессии и статуса Google токенов.
- **Требует:** JWT аутентификацию.
- **Возвращает:**  
  ```json
  {
      "authenticated": true,
      "user": {
          "id": number,
          "email": string,
          "name": string
      },
      "google_oauth": {
          "connected": boolean,
          "token_status": "valid" | "refreshed" | "invalid" | null
      }
  }
  ```

---

### Ассистенты (/assistants)

#### **POST /assistants/email/gmail**

- **Назначение:** Проверка валидности Gmail токена.
- **Принимает:**  
  - `token`: string – Gmail access token в заголовке Authorization.
- **Возвращает:**  
  ```json
  {
      "status": "success",
      "message": "Gmail токен валиден"
  }
  ```
- **Ошибки:**
  - 401 – невалидный токен.
  - 500 – внутренняя ошибка сервера.

---

## Запуск приложения

Для локального запуска проекта используйте команду:
```bash
remix dev
```

Это запустит сервер разработки, позволяющий тестировать и отлаживать приложение в режиме реального времени.
